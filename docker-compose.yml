services:
  fanuc-ros2:
    build:
      context: .
      dockerfile: Dockerfile
    image: fanuc-ros2-humble
    container_name: fanuc-ros2-humble
    stdin_open: true
    tty: true
    network_mode: host
    environment:
      - DISPLAY=${DISPLAY}
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID:-0}
      - ROS_LOCALHOST_ONLY=${ROS_LOCALHOST_ONLY:-0}
      - QT_X11_NO_MITSHM=1
      - XDG_RUNTIME_DIR=/tmp/runtime-root
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      # Uncomment to persist workspace changes
      # - ./workspace:/root/ws_fanuc
      # Uncomment to share local code or configurations
      # - ./config:/root/config:ro
    devices:
      - /dev/dri:/dev/dri  # GPU access for hardware-accelerated rendering
    # Uncomment for privileged access (needed for some hardware interfaces)
    # privileged: true
    command: /bin/bash

  # Optional: Separate service for visualization with mock hardware
  fanuc-viz:
    build:
      context: .
      dockerfile: Dockerfile
    image: fanuc-ros2-humble
    container_name: fanuc-ros2-viz
    stdin_open: true
    tty: true
    network_mode: host
    environment:
      - DISPLAY=${DISPLAY}
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID:-0}
      - QT_X11_NO_MITSHM=1
      - XDG_RUNTIME_DIR=/tmp/runtime-root
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    devices:
      - /dev/dri:/dev/dri
    command: >
      bash -c "source /opt/ros/humble/setup.bash &&
               source /root/ws_fanuc/install/setup.bash &&
               ros2 launch fanuc_moveit_config fanuc_moveit.launch.py robot_model:=crx10ia use_mock:=true"
    profiles:
      - visualization

